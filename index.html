<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ì—°ê¸ˆê³„ì¢Œ ê³„ì‚°ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f6f8; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; font-size: 24px; }
        
        .input-group { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; margin-bottom: 20px; }
        .input-box { flex: 1 1 45%; display: flex; flex-direction: column; }
        label { font-size: 14px; margin-bottom: 5px; font-weight: 500; color: #555; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { border-color: #4a90e2; box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1); }
        
        button { width: 100%; padding: 15px; background-color: #4a90e2; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        button:hover { background-color: #357abd; transform: translateY(-2px); }
        
        .result-section { margin-top: 40px; text-align: center; display: none; /* ê³„ì‚° ì „ì—” ìˆ¨ê¹€ */ }
        .chart-container { position: relative; height: 400px; width: 100%; margin-top: 20px; }
        .highlight { color: #4a90e2; font-weight: bold; }
        .summary-box { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ˆ ë‚´ ë…¸í›„ ìì‚°ì€ ì–¼ë§ˆì¼ê¹Œ? (100ì„¸ ê¸°ì¤€)</h1>
    
    <div class="input-group">
        <div class="input-box">
            <label>í˜„ì¬ ë‚˜ì´ (ì„¸)</label>
            <input type="number" id="startAge" value="30">
        </div>
        <div class="input-box">
            <label>ì—° ì˜ˆìƒ ìˆ˜ìµë¥  (%)</label>
            <input type="number" id="rate" value="10">
        </div>
        <div class="input-box">
            <label>ì›” ë‚©ì…ê¸ˆ (ë§Œì›)</label>
            <input type="number" id="monthlyAmount" value="10">
        </div>
        <div class="input-box">
            <label>ì—°ê¸ˆ ìˆ˜ë ¹ ì‹œì‘ ë‚˜ì´ (ì„¸)</label>
            <input type="number" id="targetAge" value="55">
        </div>
        <div class="input-box">
            <label>ì—° í¬ë§ ìˆ˜ë ¹ì•¡ (ë§Œì›)</label>
            <input type="number" id="withdrawAmount" value="1500">
        </div>
    </div>

    <button onclick="calculatePension()">ê³„ì‚°í•˜ê¸°</button>

    <div class="result-section" id="resultSection">
        <div class="summary-box">
            <p>ìì‚°ì´ ìµœëŒ€ <span class="highlight" id="peakAsset">0ì–µ 0000ë§Œ</span>ì›ê¹Œì§€ ëª¨ì…ë‹ˆë‹¤.</p>
            <p><span class="highlight" id="peakAge">00</span>ì„¸ ì´í›„ ë§¤ë…„ <span id="displayWithdraw">0</span>ë§Œì›ì”© ì“°ë©´,</p>
            <p><span class="highlight" id="emptyAge" style="color:#e74c3c;">00</span>ì„¸ì— ìì‚°ì´ ê³ ê°ˆë©ë‹ˆë‹¤..</p></p
        </div>
        <div class="chart-container">
            <canvas id="pensionChart"></canvas>
        </div>
    </div>
</div>

<script>
    let myChart = null;

    function calculatePension() {
        // 1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
        const startAge = parseInt(document.getElementById('startAge').value);
        const rate = parseFloat(document.getElementById('rate').value) / 100;
        const monthlyAmount = parseInt(document.getElementById('monthlyAmount').value);
        const targetAge = parseInt(document.getElementById('targetAge').value);
        const withdrawAmount = parseInt(document.getElementById('withdrawAmount').value);

        // ìœ íš¨ì„± ê²€ì‚¬
        if (startAge >= targetAge) {
            alert("ìˆ˜ë ¹ ë‚˜ì´ëŠ” í˜„ì¬ ë‚˜ì´ë³´ë‹¤ ë§ì•„ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }

        // 2. ê³„ì‚° ë¡œì§ (ì—‘ì…€ ë¡œì§ ë°˜ì˜)
        let labels = []; // Xì¶•: ë‚˜ì´
        let data = [];   // Yì¶•: ìì‚°
        let currentAsset = 0;
        let maxAsset = 0;
        let depletionAge = null;

        // ì‹œë®¬ë ˆì´ì…˜: í˜„ì¬ ë‚˜ì´ë¶€í„° 100ì„¸ê¹Œì§€
        for (let age = startAge; age <= 100; age++) {
            labels.push(age + "ì„¸");
            
            if (age === startAge) {
                // ì²« í•´ëŠ” 0ì›ë¶€í„° ì‹œì‘ (í˜¹ì€ 0ì›)
                currentAsset = 0; 
            } else if (age <= targetAge) {
                // [ì ë¦½ê¸°]
                // ì—‘ì…€ ë¡œì§: (ì „ë…„ë„ ìì‚° * (1+ìˆ˜ìµë¥ )) + (ì›”ë‚©ì…ê¸ˆ * 12)
                // *ì£¼ì˜: ì›”ë³µë¦¬ê°€ ì •í™•í•˜ë‚˜ ì—‘ì…€ íŒŒì¼ ë¡œì§ì¸ 'ì—° ë‹¨ìœ„ ë¶ˆì…'ìœ¼ë¡œ ë‹¨ìˆœí™” êµ¬í˜„
                currentAsset = (currentAsset * (1 + rate)) + (monthlyAmount * 12);
            } else {
                // [ìˆ˜ë ¹ê¸°]
                // ì—‘ì…€ ë¡œì§: (ì „ë…„ë„ ìì‚° * (1+ìˆ˜ìµë¥ )) - ì—°ê°„ìˆ˜ë ¹ì•¡
                currentAsset = (currentAsset * (1 + rate)) - withdrawAmount;
            }

            // ìì‚°ì´ 0 ë¯¸ë§Œì´ ë˜ë©´ ë©ˆì¶¤ (ê³ ê°ˆ)
            if (currentAsset < 0) {
                currentAsset = 0;
                if (!depletionAge) depletionAge = age; // ê³ ê°ˆëœ ë‚˜ì´ ê¸°ë¡
            }

            // ìµœëŒ€ ìì‚° ê¸°ë¡
            if (currentAsset > maxAsset) maxAsset = currentAsset;

            data.push(Math.round(currentAsset));
        }

        // 3. ê²°ê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('resultSection').style.display = 'block';
        document.getElementById('peakAge').innerText = targetAge;
        document.getElementById('peakAsset').innerText = formatMoney(maxAsset);
        document.getElementById('displayWithdraw').innerText = withdrawAmount.toLocaleString();
        
        if (depletionAge) {
            document.getElementById('emptyAge').innerText = depletionAge;
            document.getElementById('emptyAge').style.color = "#e74c3c"; // ë¹¨ê°„ìƒ‰
        } else {
            document.getElementById('emptyAge').innerText = "100ì„¸ ì´ìƒ";
            document.getElementById('emptyAge').style.color = "#2ecc71"; // ì´ˆë¡ìƒ‰
        }

        // 4. ì°¨íŠ¸ ê·¸ë¦¬ê¸° (Chart.js)
        drawChart(labels, data, targetAge - startAge);
    }

    // ê¸ˆì•¡ í¬ë§·íŒ… í•¨ìˆ˜ (ì˜ˆ: 1ì–µ 5000ë§Œ)
    function formatMoney(amount) {
        if (amount >= 10000) {
            const eok = Math.floor(amount / 10000);
            const man = Math.round(amount % 10000);
            return eok + "ì–µ " + (man > 0 ? man + "ë§Œ" : "");
        }
        return Math.round(amount) + "ë§Œ";
    }

    function drawChart(labels, data, peakIndex) {
        const ctx = document.getElementById('pensionChart').getContext('2d');

        // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì‚­ì œ (ì¤‘ë³µ ë°©ì§€)
        if (myChart) myChart.destroy();

        // ì ë¦½ êµ¬ê°„ê³¼ ìˆ˜ë ¹ êµ¬ê°„ ìƒ‰ìƒ ë‹¤ë¥´ê²Œ í•˜ê¸°ëŠ” ë³µì¡í•˜ë¯€ë¡œ ë‹¨ì¼ ì»¬ëŸ¬ í˜¹ì€ ê·¸ë¼ë°ì´ì…˜ ì‚¬ìš©
        // ì—¬ê¸°ì„œëŠ” ì‹¬í”Œí•˜ê²Œ íŒŒë€ìƒ‰ìœ¼ë¡œ í†µì¼í•˜ë˜, ë°°ê²½ìƒ‰ì„ ì…í˜
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ì´ ìì‚° (ë§Œì›)',
                    data: data,
                    borderColor: '#4a90e2',
                    backgroundColor: 'rgba(74, 144, 226, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0, // í¬ì¸íŠ¸ ìˆ¨ê¹€ (ê¹”ë”í•˜ê²Œ)
                    pointHitRadius: 10,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return formatMoney(context.raw) + "ì›";
                            }
                        }
                    },
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { borderDash: [5, 5] }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    }
</script>

</body>
</html>
