<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X9N3GDWMD6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-X9N3GDWMD6');
    </script>
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W6MMMFDL');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ì—°ê¸ˆ ê³„ì‚°ê¸°</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f6f8; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; font-size: 24px; }
        
        .input-group { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; margin-bottom: 20px; }
        .input-box { flex: 1 1 45%; display: flex; flex-direction: column; }
        label { font-size: 14px; margin-bottom: 5px; font-weight: 500; color: #555; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { border-color: #4a90e2; box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1); }
        
        /* ë©”ì¸ ë²„íŠ¼ (ê³„ì‚°í•˜ê¸°) */
        .btn-calc { width: 100%; padding: 15px; background-color: #4a90e2; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .btn-calc:hover { background-color: #357abd; transform: translateY(-2px); }

        /* ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ (ì´ˆë¡ìƒ‰) */
        .btn-excel { width: 100%; padding: 12px; background-color: #27ae60; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 15px; display: none; transition: 0.2s; }
        .btn-excel:hover { background-color: #219150; transform: translateY(-2px); }
        
        .result-section { margin-top: 40px; text-align: center; display: none; }
        .chart-container { position: relative; height: 400px; width: 100%; margin-top: 20px; }
        .highlight { color: #4a90e2; font-weight: bold; font-size: 1.1em; }
        .summary-box { background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 20px; line-height: 1.8; text-align: left; }
        .summary-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 5px 0; }
        .summary-item:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W6MMMFDL"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->


<div class="container">
    <h1>ğŸ“ˆ ê°œì¸ì—°ê¸ˆ ê³„ì‚°ê¸° (100ì„¸ ê¸°ì¤€)</h1>
    
    <div class="input-group">
        <div class="input-box">
            <label>ì‹œì‘ ë‚˜ì´ (ì„¸)</label>
            <input type="number" id="startAge" value="30">
        </div>
        <div class="input-box">
            <label>ì—° ìˆ˜ìµë¥  (%)</label>
            <input type="number" id="rate" value="10">
        </div>
        <div class="input-box">
            <label>ì›” ë‚©ì…ê¸ˆ (ë§Œì›)</label>
            <input type="number" id="monthlyAmount" value="50">
        </div>
        <div class="input-box">
            <label>ì—°ê¸ˆ ìˆ˜ë ¹ ì‹œì‘ ë‚˜ì´ (ì„¸)</label>
            <input type="number" id="targetAge" value="55">
        </div>
        <div class="input-box">
            <label>ì—° í¬ë§ ìˆ˜ë ¹ì•¡ (ë§Œì›)</label>
            <input type="number" id="withdrawAmount" value="2000">
        </div>
    </div>

    <button class="btn-calc" onclick="calculatePension()">ê³„ì‚°í•˜ê¸°</button>

    <div class="result-section" id="resultSection">
        <div class="summary-box">
            <div class="summary-item">
                <span>ğŸ’° ì´ ë‚©ì…í•œ ì›ê¸ˆ</span>
                <span class="highlight" style="color: #555;" id="totalPrincipal">0ë§Œì›</span>
            </div>
            <div class="summary-item">
                <span>ğŸš€ ë¶ˆì–´ë‚œ ìµœëŒ€ ìì‚° (<span id="peakAge">00</span>ì„¸)</span>
                <span class="highlight" id="peakAsset">0ë§Œì›</span>
            </div>
            <div class="summary-item">
                <span>ğŸ’¸ ìì‚° ê³ ê°ˆ ë‚˜ì´</span>
                <span class="highlight" id="emptyAge" style="color:#e74c3c;">00ì„¸</span>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="pensionChart"></canvas>
        </div>

        <button class="btn-excel" id="excelBtn" onclick="downloadExcel()">ğŸ“Š ì—‘ì…€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ</button>
    </div>
</div>

<script>
    let myChart = null;
    let excelData = []; // ì—‘ì…€ ì €ì¥ì„ ìœ„í•œ ì „ì—­ ë°ì´í„°

    function calculatePension() {
        // 1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
        const startAge = parseInt(document.getElementById('startAge').value);
        const rate = parseFloat(document.getElementById('rate').value) / 100;
        const monthlyAmount = parseInt(document.getElementById('monthlyAmount').value);
        const targetAge = parseInt(document.getElementById('targetAge').value);
        const withdrawAmount = parseInt(document.getElementById('withdrawAmount').value);

        if (startAge >= targetAge) {
            alert("ìˆ˜ë ¹ ë‚˜ì´ëŠ” í˜„ì¬ ë‚˜ì´ë³´ë‹¤ ë§ì•„ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }

        // 2. ì´ˆê¸°í™”
        let labels = []; 
        let data = [];
        excelData = []; // ì—‘ì…€ ë°ì´í„° ì´ˆê¸°í™”
        
        let currentAsset = 0;
        let maxAsset = 0;
        let depletionAge = null;

        // ì´ ë‚©ì… ì›ê¸ˆ ê³„ì‚°: (ë‚©ì… ê¸°ê°„ ì—°ìˆ˜) * 12ê°œì›” * ì›”ë‚©ì…ì•¡
        const totalPrincipal = (targetAge - startAge) * 12 * monthlyAmount;

        // 3. ì‹œë®¬ë ˆì´ì…˜ ë¡œì§
        for (let age = startAge; age <= 100; age++) {
            labels.push(age + "ì„¸");
            
            let status = ""; // ì—‘ì…€ìš© ìƒíƒœ êµ¬ë¶„ (ë‚©ì…ê¸°/ìˆ˜ë ¹ê¸°)
            let cashFlow = 0; // ì—‘ì…€ìš© í˜„ê¸ˆ íë¦„

            if (age === startAge) {
                currentAsset = 0;
                status = "ì‹œì‘";
            } else if (age <= targetAge) {
                // ë‚©ì…ê¸°
                currentAsset = (currentAsset * (1 + rate)) + (monthlyAmount * 12);
                status = "ë‚©ì…ì¤‘";
                cashFlow = monthlyAmount * 12;
            } else {
                // ìˆ˜ë ¹ê¸°
                currentAsset = (currentAsset * (1 + rate)) - withdrawAmount;
                status = "ìˆ˜ë ¹ì¤‘";
                cashFlow = -withdrawAmount;
            }

            if (currentAsset < 0) {
                currentAsset = 0;
                if (!depletionAge) depletionAge = age;
                status = "ìì‚°ê³ ê°ˆ";
            }

            if (currentAsset > maxAsset) maxAsset = currentAsset;

            // ë°˜ì˜¬ë¦¼ ì²˜ë¦¬
            const roundedAsset = Math.round(currentAsset);
            data.push(roundedAsset);

            // ì—‘ì…€ìš© ë°ì´í„° ì €ì¥
            excelData.push({
                "ë‚˜ì´": age + "ì„¸",
                "ìƒíƒœ": status,
                "ì´ ìì‚°(ë§Œì›)": roundedAsset,
                "ë‚©ì…/ìˆ˜ë ¹ì•¡(ë§Œì›)": age <= startAge ? 0 : cashFlow
            });
        }

        // 4. ê²°ê³¼ UI ì—…ë°ì´íŠ¸
        document.getElementById('resultSection').style.display = 'block';
        document.getElementById('excelBtn').style.display = 'inline-block'; // ì—‘ì…€ ë²„íŠ¼ ë³´ì´ê¸°
        
        document.getElementById('totalPrincipal').innerText = formatMoney(totalPrincipal);
        document.getElementById('peakAge').innerText = targetAge;
        document.getElementById('peakAsset').innerText = formatMoney(maxAsset);
        
        const emptyEl = document.getElementById('emptyAge');
        if (depletionAge) {
            emptyEl.innerText = depletionAge + "ì„¸";
            emptyEl.style.color = "#e74c3c";
        } else {
            emptyEl.innerText = "100ì„¸ ì´ìƒ ìœ ì§€";
            emptyEl.style.color = "#2ecc71";
        }

        // 5. ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        drawChart(labels, data, targetAge - startAge);
    }

    // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
    function downloadExcel() {
        if(excelData.length === 0) {
            alert("ë¨¼ì € ê³„ì‚°í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
            return;
        }

        // SheetJS ê¸°ëŠ¥ ì‚¬ìš©
        const ws = XLSX.utils.json_to_sheet(excelData); // JSON ë°ì´í„°ë¥¼ ì‹œíŠ¸ë¡œ ë³€í™˜
        const wb = XLSX.utils.book_new(); // ìƒˆ ì—‘ì…€ íŒŒì¼ ìƒì„±
        XLSX.utils.book_append_sheet(wb, ws, "ì—°ê¸ˆì‹œë®¬ë ˆì´ì…˜"); // ì‹œíŠ¸ ì¶”ê°€

        // íŒŒì¼ ì €ì¥ (íŒŒì¼ëª…: ì—°ê¸ˆê³„ì‚°ê²°ê³¼_ë‚ ì§œ.xlsx)
        const dateStr = new Date().toISOString().slice(0,10);
        XLSX.writeFile(wb, `ì—°ê¸ˆê³„ì‚°ê²°ê³¼_${dateStr}.xlsx`);
    }

    function formatMoney(amount) {
        if (amount >= 10000) {
            const eok = Math.floor(amount / 10000);
            const man = Math.round(amount % 10000);
            return eok + "ì–µ " + (man > 0 ? man + "ë§Œ" : "") + "ì›";
        }
        return Math.round(amount).toLocaleString() + "ë§Œì›";
    }

    function drawChart(labels, data, peakIndex) {
        const ctx = document.getElementById('pensionChart').getContext('2d');
        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ì´ ìì‚° (ë§Œì›)',
                    data: data,
                    borderColor: '#4a90e2',
                    backgroundColor: 'rgba(74, 144, 226, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0,
                    pointHitRadius: 10,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return formatMoney(context.raw);
                            }
                        }
                    },
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, grid: { borderDash: [5, 5] } },
                    x: { grid: { display: false } }
                }
            }
        });
    }
</script>

</body>
</html>
